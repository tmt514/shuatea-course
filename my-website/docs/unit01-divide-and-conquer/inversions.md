---
sidebar_position: 14
sidebar_label: "ğŸŸ¨ é€†åºæ•¸å° Inversions"
---

# é€†åºæ•¸å° Inversions

:::note é€†åºæ•¸å°å•é¡Œ Inversions
çµ¦å®šä¸€å€‹é•·åº¦ç‚º $n$ çš„æ•´æ•¸é™£åˆ— $A[0..n-1]$ï¼Œè«‹è¨ˆç®—æœ‰å¤šå°‘å€‹è¨»æ¨™é…å° $(i, j)$ ä½¿å¾— $i < j$ ä½†æ˜¯ $A[i] > A[j]$ã€‚
:::

## è§£é¡Œæ€è€ƒ

ç›´æ¥æšèˆ‰æ‰€æœ‰å¯èƒ½çš„æ•¸å°ï¼Œä¸¦ä¸”è¨ˆæ•¸ï¼Œéœ€è¦ $O(n^2)$ çš„æ™‚é–“ã€‚åˆ†è€Œæ²»ä¹‹çš„æƒ³æ³•æœ‰æ™‚å€™å°±åƒæ˜¯ä¸€å€‹æ¨¡æ¿ï¼Œå¥—ä¸‹å»è©¦è©¦çœ‹ï¼Œèªªä¸å®šæœ‰æ©Ÿæœƒå¾—åˆ°æœ‰è¶£çš„è§€å¯Ÿã€‚é€™é¡Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¦‚æœæˆ‘å€‘ç¡¬ç”Ÿç”Ÿåœ°åƒåˆä½µæ’åºæ³•ä¸€æ¨£ï¼Œå°‡è³‡æ–™åˆ†æˆå·¦é‚Š $A[0..n/2-1]$ å’Œå³é‚Š $A[n/2..n-1]$ å…©å †ï¼šé‚£éº¼æˆ‘å€‘å¯ä»¥ç™¼ç¾é€†åºæ•¸å°ç¸½æ•¸ï¼Œæ°å¥½ç­‰æ–¼å·¦é‚Šé‚£å †é€†åºæ•¸å°ç¸½æ•¸ã€åŠ ä¸Šå³é‚Šé‚£å †é€†åºæ•¸å°ç¸½æ•¸ã€åŠ ä¸Šã€Œå·¦é‚ŠæŒ‘ä¸€å€‹ã€å³é‚ŠæŒ‘ä¸€å€‹è€Œä¸”å·¦é‚Šæ¯”å³é‚Šå¤§ã€çš„é…å°æ•¸ã€‚

è¦æ€éº¼è§£æ±ºé€™å€‹ã€Œå·¦å³å„æŒ‘ä¸€å€‹ä¸¦æ»¿è¶³æ¢ä»¶ã€çš„è¨ˆæ•¸å•é¡Œå‘¢ï¼Ÿé€™æ™‚å€™æˆ‘å€‘ä¾¿èƒ½å¤ ç™¼ç¾ï¼Œå¦‚æœå·¦é‚Šå’Œå³é‚Šéƒ½å„è‡ªæ’å¥½é †åºäº†ï¼Œé‚£éº¼è€ƒæ…®æ¯å€‹å·¦é‚Šçš„æ•¸å­— $A[\ell]$ï¼Œåªè¦èƒ½å¤ æ‰¾å‡ºå³é‚Šç¬¬ä¸€å€‹æ¯” $A[\ell]$ å°çš„æ•¸å­—ï¼Œå†ä¾æ“šè©²æ•¸å­—çš„ä½ç½®å°±èƒ½å¤ ç®—å‡ºæœ‰å¤šå°‘å½¢å¦‚ $(\ell, ?)$ çš„é…å°äº†ã€‚

## åƒè€ƒç¨‹å¼ç¢¼(C++)

```cpp {7,14}
int combine(int A[], int l, int mid, int r) {
  int *tmp = new int[r - l + 1];
  int i = l, j = mid, k = 0, count_total = 0;
  while (i < mid || j <= r) {
    if (j > r || (i < mid && A[i] <= A[j])) {
      tmp[k++] = A[i++];
      count_total += j - mid;
    } else {
      tmp[k++] = A[j++];
    }
  }
  for (int i = l; i <= r; i++) A[i] = tmp[i - l];
  delete[] tmp;
  return count_total;
}

int count_inversions_impl(int A[], int l, int r) {
  if (l >= r) return 0;
  int mid = (l + r)/2;
  int count_left = count_inversions_impl(A, l, mid);
  int count_right = count_inversions_impl(A, mid+1, r);
  int count_mid = combine(A, l, mid+1, r);
  return count_left + count_right + count_mid;
}

int count_inversions(int A[], int n) {
  return count_inversions_impl(A, 0, n - 1);
}
```

é€™å€‹å¯«æ³•è·Ÿåˆä½µæ’åºåªç›¸å·®äº†ä¸€é»é»ï¼Œå¯ä»¥è¦–ç‚ºåˆä½µæ’åºæ³•çš„ä¸€å€‹æœ‰è¶£æ‡‰ç”¨ã€‚