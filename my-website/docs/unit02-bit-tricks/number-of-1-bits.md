---
sidebar_position: 13
sidebar_label: "ğŸŸ¨ è¨ˆç®—æœ‰æ•ˆä½å…ƒæ•¸é‡"
---

# è¨ˆç®—æœ‰æ•ˆä½å…ƒæ•¸é‡

:::note è¨ˆç®—æœ‰æ•ˆä½å…ƒæ•¸é‡ POPCOUNT
çµ¦å®šä¸€å€‹æ­£æ•´æ•¸ $x$ï¼Œè¨ˆç®—å…¶å¯«æˆäºŒé€²ä½æ™‚ $1$-bit çš„æ•¸é‡ã€‚

ä¾‹å¦‚è¼¸å…¥ç‚º $x=21$ æ™‚ï¼Œè¼¸å‡ºç‚º $3$ã€‚
:::

ç›´æ¥è¨ˆç®—ç•¶ç„¶å¯ä»¥ï¼Œæˆ‘å€‘å¯ä»¥é€éé‡è¤‡æ‰¾å‡º LSB ä¾†æ±‚å¾—ç­”æ¡ˆã€‚

```cpp
int popcount(int x) {
  int count = 0;
  while (x != 0) {
    x &= (x - 1);
    count++;
  }
  return count;
}
```

## ä¸€å€‹åˆ†è€Œæ²»ä¹‹çš„æƒ³æ³•

å‡è¨­æˆ‘å€‘ä»Šå¤©æ‹¿åˆ°çš„æ˜¯ä¸€å€‹ 32-ä½å…ƒæ•´æ•¸ã€‚é‚£éº¼æˆ‘å€‘ä¸é›£ç™¼ç¾å®ƒçš„æœ‰æ•ˆä½å…ƒæ•¸é‡ï¼Œç­‰æ–¼å‰é¢è¼ƒé«˜çš„ 16-ä½å…ƒéƒ¨åˆ†çš„æœ‰æ•ˆä½å…ƒæ•¸é‡ï¼ŒåŠ ä¸Šå¾Œé¢è¼ƒä½çš„ 16-ä½å…ƒéƒ¨åˆ†çš„æœ‰æ•ˆä½å…ƒæ•¸é‡ã€‚å› æ­¤æˆ‘å€‘å¯ä»¥ã€Œæƒ³åƒã€å‡ºä¸€å€‹åˆ†è€Œæ²»ä¹‹çš„æ–¹æ³•ï¼šç•¶æˆ‘å€‘æœ‰å€‹ $n$-ä½å…ƒçš„æ•´æ•¸æ™‚ï¼Œæˆ‘å€‘ç¸½å¯ä»¥æŠŠå®ƒåˆ†æˆå…©æ®µ $(n/2)$-ä½å…ƒçš„æ•´æ•¸ï¼Œä¸¦å°‡å„è‡ªçš„æœ‰æ•ˆä½å…ƒæ•¸é‡åŠ èµ·ä¾†ã€‚

![](popcount.gif)

ä½å…ƒçµ„è¨ˆç®—å²å®³çš„åœ°æ–¹æ˜¯ï¼Œå¾ä¸‹è€Œä¸Šçš„æ¯ä¸€å±¤ï¼Œä¸éœ€è¦åˆ†æˆæ•¸æ¬¡éè¿´ï¼Œå¯ä»¥ç›´æ¥ä¸€å£æ°£å…¨éƒ¨åŠ èµ·ä¾†ï¼æ–¼æ˜¯æˆ‘å€‘å°±å¾—åˆ°ä»¥ä¸‹é©ç”¨æ–¼ 32-bit ç„¡è™Ÿæ•´æ•¸çš„è¨ˆç®—æ–¹æ³•ï¼š

```cpp
int popcount(uint32_t x) {
  x = (x & 0x55555555) + ((x>>1) & 0x55555555);
  x = (x & 0x33333333) + ((x>>2) & 0x33333333);
  x = (x & 0x0F0F0F0F) + ((x>>4) & 0x0F0F0F0F);
  x = (x & 0x00FF00FF) + ((x>>8) & 0x00FF00FF);
  x = (x & 0x0000FFFF) + ((x>>16) & 0x0000FFFF);
  return x;
}
```